<!DOCTYPE html>
<html>
<head>
  <title>TagRace Character Check-In</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: url('tagrace-bg.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    input, button, label, select {
      font-size: 1em;
      padding: 0.6em 1em;
      margin-top: 1em;
      border: 2px solid white;
      border-radius: 6px;
      background-color: transparent;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    select {
      width: 80%;
      max-width: 300px;
      background-color: rgba(255,255,255,0.1);
    }
    input[type="text"] {
      width: 80%;
      max-width: 300px;
      color: white;
      background-color: rgba(255,255,255,0.1);
    }
    input::placeholder {
      color: white;
      opacity: 1;
    }
    input[type="file"] {
      display: none;
    }
    label.custom-file-button:hover,
    button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
    }
    label.custom-file-button:active,
    button:active {
      transform: scale(0.98);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    }
    #status {
      margin-top: 1.5em;
      font-size: 1em;
    }
    #description {
      font-size: 1em;
      margin-bottom: 1.5em;
      line-height: 1.5;
      background: rgba(0,0,0,0.5);
      padding: 1em;
      border-radius: 8px;
      display: inline-block;
    }
    #location-info {
      margin-top: 1em;
      font-size: 1em;
      background: rgba(0,0,0,0.5);
      padding: 1em;
      border-radius: 8px;
      display: inline-block;
    }
    @keyframes flashBolt {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.3; transform: scale(1.2); }
    }
    #status.flash {
      animation: flashBolt 1s infinite;
    }
    .checkin-button {
      background-color: #00ff66;
      color: black;
      border: none;
      padding: 0.8em 1.5em;
      font-size: 1.1em;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0,255,100,0.8);
      animation: glowPulse 1.5s infinite;
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 10px rgba(0,255,100,0.6); transform: scale(1); }
      50% { box-shadow: 0 0 25px rgba(0,255,100,1); transform: scale(1.05); }
      100% { box-shadow: 0 0 10px rgba(0,255,100,0.6); transform: scale(1); }
    }
    #version-tag {
  font-size: 0.8em;
  color: white;
  opacity: 0.6;
  margin-top: 3em;
}
      #photo-confirmation {
    animation: fadeIn 0.8s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  </style>
</head>
<body>
  <h1>TagRace GPS Check-In</h1>

  <p id="description">
    Congratulations on finding this character! It is part of <strong>TagRace</strong>‚Äîa global adventure race, tracking real-world movement.<br>
    They are currently on a journey to <strong>Hope, Canada</strong>, carried by people all around the world!<br>
    You are now part of the journey! Every check-in helps trace its path across continents. Take this character along with you on your adventures and snap photos in interesting locations. After moving it along, leave it in a safe space or pass it to the next person to continue with its global journey.<br><br>
    üèÅ <strong>Help it reach its final destination!</strong>
  </p>
<label for="language-select" style="margin-top: 1em; display: block;">üåç Choose your language:</label>
<select id="language-select">
  <option value="en">English</option>
  <option value="zu">Zulu</option>
  <option value="af">Afrikaans</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="ja">Japanese</option>
  <option value="zh">Chinese</option>
  <option value="es">Spanish</option>
  <option value="it">Italian</option>
  <option value="ru">Russian</option>
</select>
  <select id="tagId">
    <option value="ZA-004">Hippo</option>
    <option value="ZA-005">Penguin</option>
<option value="ZA-001">Spongebob</option>
<option value="ZA-002">Patrick</option>
<option value="ZA-003">3 Smileys</option>
  </select>
  <br>

  <input type="text" id="name" placeholder="Your name (optional)">
<br><br> <!-- Adds extra vertical space -->

<div style="margin-top: 1em;">
  <label for="photo" class="custom-file-button">üì∏ Add Photo</label>
</div>
<input type="file" id="photo" accept="image/*" capture="environment">
  <div id="photo-confirmation" style="margin-top: 0.5em; font-size: 0.9em; color: #00ffcc; display: none;">
  ‚úÖ Photo uploaded successfully!
</div>

  <br>

  <button id="checkin-button" class="checkin-button" onclick="getLocation()">‚ö° Click to update location!</button>
  <div id="status" class="flash">‚ö° Waiting for check-in‚Ä¶</div>

  <a href="map.html" target="_blank">
    <button>üó∫Ô∏è View Journey!</button>
  </a>

  <div id="location-info">üìç Loading last known location‚Ä¶</div>

  <p style="margin-top: 2em; font-size: 0.9em; color: white; opacity: 0.8;">
    üì∏ Follow <strong>#TagRaceZA</strong> on Instagram to see the global journey unfold.
  </p>

  <script>
    async function getLocation() {
      const status = document.getElementById("status");
      status.innerText = "üì° Uploading photo‚Ä¶";
      status.classList.add("flash");

      const photoInput = document.getElementById("photo");
      const file = photoInput.files[0];
      let photoUrl = "";

      if (file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("UPLOADCARE_STORE", "1");
  formData.append("UPLOADCARE_PUB_KEY", "b6fd2347b271da80d239");

  try {
    const res = await fetch("https://upload.uploadcare.com/base/", {
      method: "POST",
      body: formData
    });
    const data = await res.json();
if (data.file) {
  photoUrl = `https://4143hk85cv.ucarecd.net/${data.file}/${Date.now()}.jpg`;
  console.log("‚úÖ Uploaded photo URL:", photoUrl);
  document.getElementById("photo-confirmation").style.display = "block";
} else {
  console.warn("‚ö†Ô∏è Uploadcare response missing file ID:", data);
  document.getElementById("photo-confirmation").style.display = "none";
}

  } catch (err) {
    console.error("‚ùå Photo upload failed:", err);
  }
}

      status.innerText = "üì° Getting location‚Ä¶";

      if (!navigator.geolocation) {
        status.innerText = "‚ùå Geolocation not supported.";
        status.classList.remove("flash");
        return;
      }

      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const location = `${lat},${lon}`;
        const nameInput = document.getElementById("name").value.trim();
        const name = nameInput || "Anonymous";
        const tagId = document.getElementById("tagId")?.value || "ZA-004";

        const payload = {
          tagId,
          location,
          battery: "3.8V",
          status: "active",
          timestamp: new Date().toISOString(),
          name,
          photo: photoUrl
        };

        console.log("üì¶ Final payload:", payload);
        await sendPayload(payload);
      }, err => {
        status.innerText = "‚ùå Location error: " + err.message;
        status.classList.remove("flash");
      });
    }

    async function sendPayload(payload) {
      const status = document.getElementById("status");
      status.innerText = "üì° Sending check-in‚Ä¶";
      status.classList.add("flash");

      try {
        const res = await fetch("https://tagrace-webhook.onrender.com/smarttag", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data: payload })
        });
        if (res.ok) {
          status.innerText = "‚úÖ Check-in successful!";
          status.classList.remove("flash");
        } else {
          const text = await res.text();
          status.innerText = `‚ùå Server error: ${text}`;
          status.classList.remove("flash");
        }
      } catch (err) {
        console.error("‚ùå Fetch error:", err);
        status.innerText = "‚ùå Network error: " + err.message;
        status.classList.remove("flash");
      }
    }
   async function loadLastLocation(tagId) {
      const info = document.getElementById("location-info");
      info.innerText = "üìç Loading last known location‚Ä¶";

      try {
        const res = await fetch(`https://sheetdb.io/api/v1/fyyvku4q2tqb0/search?tagId=${tagId}`);
        const data = await res.json();
        if (data.length > 0) {
          const last = data[data.length - 1];
          info.innerText = `üìç Last check-in: ${last.location} by ${last.name || "Anonymous"}`;
        } else {
          info.innerText = "üìç No check-ins yet for this tag.";
        }
      } catch (err) {
        info.innerText = "‚ùå Failed to load location.";
        console.error("Location fetch error:", err);
      }
    } 
     document.getElementById("tagId").addEventListener("change", function() {
  const tagId = this.value;
  loadLastLocation(tagId);
  updateButtonLabel(tagId);
});

window.addEventListener("load", () => {
  const tagId = document.getElementById("tagId").value;
  loadLastLocation(tagId);
  updateButtonLabel(tagId);
});
    function updateButtonLabel(tagId) {
  const button = document.getElementById("checkin-button");

  let name;
  switch (tagId) {
    case "ZA-001":
      name = "Spongebob";
      break;
    case "ZA-002":
      name = "Patrick";
      break;
    case "ZA-003":
      name = "3 Smileys";
      break;
    case "ZA-004":
      name = "Hippo";
      break;
    case "ZA-005":
      name = "Penguin";
      break;
    default:
      name = "the tag";
  }

  button.innerText = `‚ö° Click to update ${name}'s location!`;
}
const translations = {
  en: `Congratulations on finding this character! It is part of TagRace‚Äîa global adventure race, tracking real-world movement.
They are currently on a journey to Hope, Canada, carried by people all around the world!
You are now part of the journey! Every check-in helps trace its path across continents. Take this character along with you on your adventures and snap photos in interesting locations. After moving it along, leave it in a safe space or pass it to the next person to continue with its global journey.

üèÅ Help it reach its final destination!`,

  zu: `Halala! Uthole lo mlingiswa! Ingxenye ye-TagRace‚Äîumjaho womhlaba wonke wokuzijabulisa, olandela ukuhamba kwangempela.
Okwamanje usohambweni oluya eHope, eCanada, ethwalwa abantu abavela emhlabeni wonke!
Manje usuyingxenye yohambo! Ukubhalisa ngakunye kusiza ukulandelela indlela yalo kuwo wonke amazwekazi. Hamba nalo mlingiswa ezindaweni ezithakazelisayo futhi uthathe izithombe. Ngemuva kokuhamba naye, mshiye endaweni ephephile noma unikeze omunye umuntu aqhubeke nohambo lomhlaba wonke.

üèÅ Msize afinyelele endaweni yokuqeda!`,

  af: `Baie geluk! Jy het hierdie karakter gevind. Dit is deel van TagRace‚Äî'n w√™reldwye avontuurwedloop wat regte bewegings volg.
Hulle is tans op pad na Hope, Kanada, gedra deur mense regoor die w√™reld!
Jy is nou deel van die reis! Elke inskrywing help om die pad oor kontinente te volg. Neem hierdie karakter saam op jou avonture en neem foto's op interessante plekke. Laat dit dan in 'n veilige plek of gee dit aan die volgende persoon om die w√™reldreis voort te sit.

üèÅ Help dit om sy eindbestemming te bereik!`,

  fr: `F√©licitations pour avoir trouv√© ce personnage ! Il fait partie de TagRace‚Äîune course d'aventure mondiale qui suit les d√©placements r√©els.
Il est actuellement en route vers Hope, au Canada, port√© par des personnes du monde entier !
Vous faites maintenant partie du voyage ! Chaque enregistrement aide √† tracer son parcours √† travers les continents. Emmenez ce personnage avec vous dans vos aventures et prenez des photos dans des lieux int√©ressants. Apr√®s l'avoir d√©plac√©, laissez-le dans un endroit s√ªr ou passez-le √† la personne suivante pour poursuivre son voyage mondial.

üèÅ Aidez-le √† atteindre sa destination finale !`,

  de: `Herzlichen Gl√ºckwunsch! Du hast diesen Charakter gefunden. Er ist Teil von TagRace‚Äîeinem globalen Abenteuer-Rennen, das echte Bewegungen verfolgt.
Derzeit ist er auf dem Weg nach Hope, Kanada, getragen von Menschen aus aller Welt!
Du bist jetzt Teil der Reise! Jeder Check-in hilft, seinen Weg √ºber Kontinente nachzuverfolgen. Nimm diesen Charakter mit auf deine Abenteuer und mache Fotos an interessanten Orten. Nachdem du ihn weitergebracht hast, lasse ihn an einem sicheren Ort oder gib ihn an die n√§chste Person weiter, damit die globale Reise weitergeht.

üèÅ Hilf ihm, sein endg√ºltiges Ziel zu erreichen!`,

  ja: `„Åì„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíË¶ã„Å§„Åë„Å¶„Åè„Çå„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Åì„Çå„ÅØTagRace„ÅÆ‰∏ÄÈÉ®„Åß„Åô‚Äî‰∏ñÁïå‰∏≠„ÇíÊóÖ„Åô„Çã„É™„Ç¢„É´„Å™ÂÜíÈô∫„É¨„Éº„Çπ„Åß„Åô„ÄÇ
ÁèæÂú®„ÄÅ„Åì„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÅØ„Ç´„Éä„ÉÄ„ÅÆHope„Å´Âêë„Åã„Å£„Å¶ÊóÖ„Çí„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ñÁïå‰∏≠„ÅÆ‰∫∫„ÄÖ„Å´„Çà„Å£„Å¶ÈÅã„Å∞„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
„ÅÇ„Å™„Åü„ÇÇ„Åì„ÅÆÊóÖ„ÅÆ‰∏ÄÂì°„Åß„ÅôÔºÅ„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Åô„Çã„Åü„Å≥„Å´„ÄÅ„Åù„ÅÆË∂≥Ë∑°„ÅåÂ§ßÈô∏„ÇíË∂ä„Åà„Å¶Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ„Åì„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÂÜíÈô∫„Å´ÈÄ£„Çå„Å¶Ë°å„Åç„ÄÅÈù¢ÁôΩ„ÅÑÂ†¥ÊâÄ„ÅßÂÜôÁúü„ÇíÊíÆ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁßªÂãï„Åï„Åõ„ÅüÂæå„ÅØ„ÄÅÂÆâÂÖ®„Å™Â†¥ÊâÄ„Å´ÁΩÆ„Åè„Åã„ÄÅÊ¨°„ÅÆ‰∫∫„Å´Ê∏°„Åó„Å¶‰∏ñÁïå„ÅÆÊóÖ„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ

üèÅ ÊúÄÁµÇÁõÆÁöÑÂú∞„Å´Âà∞ÈÅî„Åô„Çã„ÅÆ„ÇíÊâã‰ºù„Å£„Å¶„Åè„Å†„Åï„ÅÑÔºÅ`,

  zh: `ÊÅ≠Âñú‰Ω†ÊâæÂà∞Ëøô‰∏™ËßíËâ≤ÔºÅÂÆÉÊòØTagRaceÁöÑ‰∏ÄÈÉ®ÂàÜ‚Äî‚Äî‰∏Ä‰∏™ÂÖ®ÁêÉÂÜíÈô©Á´ûËµõÔºåËøΩË∏™ÁúüÂÆû‰∏ñÁïåÁöÑÁßªÂä®„ÄÇ
ÂÆÉÁõÆÂâçÊ≠£Âú®ÂâçÂæÄÂä†ÊãøÂ§ßHopeÁöÑÊóÖÁ®ã‰∏≠ÔºåÁî±‰∏ñÁïåÂêÑÂú∞ÁöÑ‰∫∫‰ª¨Êê∫Â∏¶ÔºÅ
‰Ω†Áé∞Âú®ÊòØËøôÊÆµÊóÖÁ®ãÁöÑ‰∏ÄÈÉ®ÂàÜÔºÅÊØè‰∏ÄÊ¨°Á≠æÂà∞ÈÉΩÊúâÂä©‰∫éËøΩË∏™ÂÆÉÁ©øË∂äÂêÑÂ§ßÊ¥≤ÁöÑË∑ØÂæÑ„ÄÇÂ∏¶ÁùÄËøô‰∏™ËßíËâ≤ÂéªÂÜíÈô©ÔºåÂπ∂Âú®ÊúâË∂£ÁöÑÂú∞ÁÇπÊãçÁÖß„ÄÇÂú®‰Ω†ÁßªÂä®ÂÆÉ‰πãÂêéÔºåËØ∑Â∞ÜÂÆÉÁïôÂú®‰∏Ä‰∏™ÂÆâÂÖ®ÁöÑÂú∞ÊñπÔºåÊàñ‰∫§Áªô‰∏ã‰∏Ä‰∏™‰∫∫ÁªßÁª≠ÂÆÉÁöÑÂÖ®ÁêÉÊóÖÁ®ã„ÄÇ

üèÅ Â∏ÆÂä©ÂÆÉÂà∞ËææÊúÄÁªàÁõÆÁöÑÂú∞ÔºÅ`,

  es: `¬°Felicidades por encontrar este personaje! Es parte de TagRace‚Äîuna carrera de aventuras global que rastrea el movimiento real.
Actualmente est√° en camino a Hope, Canad√°, llevado por personas de todo el mundo.
¬°Ahora eres parte del viaje! Cada registro ayuda a trazar su ruta a trav√©s de los continentes. Lleva este personaje contigo en tus aventuras y toma fotos en lugares interesantes. Despu√©s de moverlo, d√©jalo en un lugar seguro o p√°salo a la siguiente persona para continuar su viaje global.

üèÅ ¬°Ay√∫dalo a llegar a su destino final!`,

  it: `Congratulazioni per aver trovato questo personaggio! Fa parte di TagRace‚Äîuna gara di avventura globale che traccia movimenti reali.
Attualmente √® in viaggio verso Hope, Canada, trasportato da persone di tutto il mondo!
Ora fai parte del viaggio! Ogni check-in aiuta a tracciare il suo percorso attraverso i continenti. Porta questo personaggio con te nelle tue avventure e scatta foto in luoghi interessanti. Dopo averlo spostato, lascialo in un luogo sicuro o passalo alla prossima persona per continuare il suo viaggio globale.

üèÅ Aiutalo a raggiungere la sua destinazione finale!`,

  ru: `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞! –û–Ω —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é TagRace‚Äî–≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–æ–π –≥–æ–Ω–∫–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—â–µ–π —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.
–°–µ–π—á–∞—Å –æ–Ω –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –•–æ—É–ø, –ö–∞–Ω–∞–¥–∞, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –ª—é–¥—å–º–∏ —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞!
–¢–µ–ø–µ—Ä—å –≤—ã —á–∞—Å—Ç—å —ç—Ç–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è! –ö–∞–∂–¥–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –µ–≥–æ –ø—É—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã. –í–æ–∑—å–º–∏—Ç–µ —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å —Å–æ–±–æ–π –≤ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–µ–º—É —á–µ–ª–æ–≤–µ–∫—É, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –µ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ.

üèÅ –ü–æ–º–æ–≥–∏—Ç–µ –µ–º—É –¥–æ—Å—Ç–∏—á—å –∫–æ–Ω–µ—á–Ω–æ–π —Ü–µ–ª–∏!`
};

document.getElementById("language-select").addEventListener("change", function () {
  const selected = this.value;
  const intro = document.getElementById("description");
  intro.innerText = translations[selected] || translations["en"];
});
  </script>
  <p id="version-tag">üîß Code Version: v1.8 ‚Äî 2025-09-23</p>
</body>
</html>
