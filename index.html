<!DOCTYPE html>
<html>
<head>
  <title>TagRace Character Check-In</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: url('tagrace-bg.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    input, button, label, select {
      font-size: 1em;
      padding: 0.6em 1em;
      margin-top: 1em;
      border: 2px solid white;
      border-radius: 6px;
      background-color: transparent;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    select {
      width: 80%;
      max-width: 300px;
      background-color: rgba(255,255,255,0.1);
    }
    input[type="text"] {
      width: 80%;
      max-width: 300px;
      color: white;
      background-color: rgba(255,255,255,0.1);
    }
    input::placeholder {
      color: white;
      opacity: 1;
    }
    input[type="file"] {
      display: none;
    }
    label.custom-file-button:hover,
    button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
    }
    label.custom-file-button:active,
    button:active {
      transform: scale(0.98);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    }
    #status {
      margin-top: 1.5em;
      font-size: 1em;
    }
    #description {
      font-size: 1em;
      margin-bottom: 1.5em;
      line-height: 1.5;
      background: rgba(0,0,0,0.5);
      padding: 1em;
      border-radius: 8px;
      display: inline-block;
    }
    #location-info {
      margin-top: 1em;
      font-size: 1em;
      background: rgba(0,0,0,0.5);
      padding: 1em;
      border-radius: 8px;
      display: inline-block;
    }
    @keyframes flashBolt {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.3; transform: scale(1.2); }
    }
    #status.flash {
      animation: flashBolt 1s infinite;
    }
    .checkin-button {
      background-color: #00ff66;
      color: black;
      border: none;
      padding: 0.8em 1.5em;
      font-size: 1.1em;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0,255,100,0.8);
      animation: glowPulse 1.5s infinite;
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 10px rgba(0,255,100,0.6); transform: scale(1); }
      50% { box-shadow: 0 0 25px rgba(0,255,100,1); transform: scale(1.05); }
      100% { box-shadow: 0 0 10px rgba(0,255,100,0.6); transform: scale(1); }
    }
    #version-tag {
  font-size: 0.8em;
  color: white;
  opacity: 0.6;
  margin-top: 3em;
}
      #photo-confirmation {
    animation: fadeIn 0.8s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  </style>
</head>
<body>
  <h1>TagRace GPS Check-In</h1>

  <p id="description">
    Congratulations on finding this character! It is part of <strong>TagRace</strong>â€”a global adventure race, tracking real-world movement.<br>
    They are currently on a journey to <strong>Hope, Canada</strong>, carried by people all around the world!<br>
    You are now part of the journey! Every check-in helps trace its path across continents. Take this character along with you on your adventures and snap photos in interesting locations. After moving it along, leave it in a safe space or pass it to the next person to continue with its global journey.<br><br>
    ğŸ <strong>Help it reach its final destination!</strong>
  </p>
<label for="language-select" style="margin-top: 1em; display: block;">ğŸŒ Choose your language:</label>
<select id="language-select">
  <option value="en">English</option>
  <option value="zu">Zulu</option>
  <option value="af">Afrikaans</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="ja">Japanese</option>
  <option value="zh">Chinese</option>
  <option value="es">Spanish</option>
  <option value="it">Italian</option>
  <option value="ru">Russian</option>
</select>
  <select id="tagId">
    <option value="ZA-004">Hippo</option>
    <option value="ZA-005">Penguin</option>
<option value="ZA-001">Spongebob</option>
<option value="ZA-002">Patrick</option>
<option value="ZA-003">3 Smileys</option>
  </select>
  <br>

  <input type="text" id="name" placeholder="Your name (optional)">
<br><br> <!-- Adds extra vertical space -->

<div style="margin-top: 1em;">
  <label for="photo" class="custom-file-button">ğŸ“¸ Add Photo</label>
</div>
<input type="file" id="photo" accept="image/*" capture="environment">
  <div id="photo-confirmation" style="margin-top: 0.5em; font-size: 0.9em; color: #00ffcc; display: none;">
  âœ… Photo uploaded successfully!
</div>

  <br>

  <button id="checkin-button" class="checkin-button" onclick="getLocation()">âš¡ Click to update location!</button>
  <div id="status" class="flash">âš¡ Waiting for check-inâ€¦</div>

  <a href="map.html" target="_blank">
    <button>ğŸ—ºï¸ View Journey!</button>
  </a>

  <div id="location-info">ğŸ“ Loading last known locationâ€¦</div>

  <p style="margin-top: 2em; font-size: 0.9em; color: white; opacity: 0.8;">
    ğŸ“¸ Follow <strong>#TagRaceZA</strong> on Instagram to see the global journey unfold.
  </p>

  <script>
    async function getLocation() {
      const status = document.getElementById("status");
      status.innerText = "ğŸ“¡ Uploading photoâ€¦";
      status.classList.add("flash");

      const photoInput = document.getElementById("photo");
      const file = photoInput.files[0];
      let photoUrl = "";

      if (file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("UPLOADCARE_STORE", "1");
  formData.append("UPLOADCARE_PUB_KEY", "b6fd2347b271da80d239");

  try {
    const res = await fetch("https://upload.uploadcare.com/base/", {
      method: "POST",
      body: formData
    });
    const data = await res.json();
if (data.file) {
  photoUrl = `https://4143hk85cv.ucarecd.net/${data.file}/${Date.now()}.jpg`;
  console.log("âœ… Uploaded photo URL:", photoUrl);
  document.getElementById("photo-confirmation").style.display = "block";
} else {
  console.warn("âš ï¸ Uploadcare response missing file ID:", data);
  document.getElementById("photo-confirmation").style.display = "none";
}

  } catch (err) {
    console.error("âŒ Photo upload failed:", err);
  }
}

      status.innerText = "ğŸ“¡ Getting locationâ€¦";

      if (!navigator.geolocation) {
        status.innerText = "âŒ Geolocation not supported.";
        status.classList.remove("flash");
        return;
      }

      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const location = `${lat},${lon}`;
        const nameInput = document.getElementById("name").value.trim();
        const name = nameInput || "Anonymous";
        const tagId = document.getElementById("tagId")?.value || "ZA-004";

        const payload = {
          tagId,
          location,
          battery: "3.8V",
          status: "active",
          timestamp: new Date().toISOString(),
          name,
          photo: photoUrl
        };

        console.log("ğŸ“¦ Final payload:", payload);
        await sendPayload(payload);
      }, err => {
        status.innerText = "âŒ Location error: " + err.message;
        status.classList.remove("flash");
      });
    }

    async function sendPayload(payload) {
      const status = document.getElementById("status");
      status.innerText = "ğŸ“¡ Sending check-inâ€¦";
      status.classList.add("flash");

      try {
        const res = await fetch("https://tagrace-webhook.onrender.com/smarttag", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ data: payload })
        });
        if (res.ok) {
          status.innerText = "âœ… Check-in successful!";
          status.classList.remove("flash");
        } else {
          const text = await res.text();
          status.innerText = `âŒ Server error: ${text}`;
          status.classList.remove("flash");
        }
      } catch (err) {
        console.error("âŒ Fetch error:", err);
        status.innerText = "âŒ Network error: " + err.message;
        status.classList.remove("flash");
      }
    }
   async function loadLastLocation(tagId) {
      const info = document.getElementById("location-info");
      info.innerText = "ğŸ“ Loading last known locationâ€¦";

      try {
        const res = await fetch(`https://sheetdb.io/api/v1/fyyvku4q2tqb0/search?tagId=${tagId}`);
        const data = await res.json();
        if (data.length > 0) {
          const last = data[data.length - 1];
          info.innerText = `ğŸ“ Last check-in: ${last.location} by ${last.name || "Anonymous"}`;
        } else {
          info.innerText = "ğŸ“ No check-ins yet for this tag.";
        }
      } catch (err) {
        info.innerText = "âŒ Failed to load location.";
        console.error("Location fetch error:", err);
      }
    } 
     document.getElementById("tagId").addEventListener("change", function() {
  const tagId = this.value;
  loadLastLocation(tagId);
  updateButtonLabel(tagId);
});

window.addEventListener("load", () => {
  const tagId = document.getElementById("tagId").value;
  loadLastLocation(tagId);
  updateButtonLabel(tagId);
});
    function updateButtonLabel(tagId) {
  const button = document.getElementById("checkin-button");

  let name;
  switch (tagId) {
    case "ZA-001":
      name = "Spongebob";
      break;
    case "ZA-002":
      name = "Patrick";
      break;
    case "ZA-003":
      name = "3 Smileys";
      break;
    case "ZA-004":
      name = "Hippo";
      break;
    case "ZA-005":
      name = "Penguin";
      break;
    default:
      name = "the tag";
  }

  button.innerText = `âš¡ Click to update ${name}'s location!`;
}
const translations = {
  en: `Congratulations on finding this character! It is part of TagRaceâ€”a global adventure race, tracking real-world movement.
They are currently on a journey to Hope, Canada, carried by people all around the world!
You are now part of the journey! Every check-in helps trace its path across continents. Take this character along with you on your adventures and snap photos in interesting locations. After moving it along, leave it in a safe space or pass it to the next person to continue with its global journey.

ğŸ Help it reach its final destination!`,

  zu: `Halala! Uthole lo mlingiswa! Ingxenye ye-TagRaceâ€”umjaho womhlaba wonke wokuzijabulisa, olandela ukuhamba kwangempela.
Okwamanje usohambweni oluya eHope, eCanada, ethwalwa abantu abavela emhlabeni wonke!
Manje usuyingxenye yohambo! Ukubhalisa ngakunye kusiza ukulandelela indlela yalo kuwo wonke amazwekazi. Hamba nalo mlingiswa ezindaweni ezithakazelisayo futhi uthathe izithombe. Ngemuva kokuhamba naye, mshiye endaweni ephephile noma unikeze omunye umuntu aqhubeke nohambo lomhlaba wonke.

ğŸ Msize afinyelele endaweni yokuqeda!`,

  af: `Baie geluk! Jy het hierdie karakter gevind. Dit is deel van TagRaceâ€”'n wÃªreldwye avontuurwedloop wat regte bewegings volg.
Hulle is tans op pad na Hope, Kanada, gedra deur mense regoor die wÃªreld!
Jy is nou deel van die reis! Elke inskrywing help om die pad oor kontinente te volg. Neem hierdie karakter saam op jou avonture en neem foto's op interessante plekke. Laat dit dan in 'n veilige plek of gee dit aan die volgende persoon om die wÃªreldreis voort te sit.

ğŸ Help dit om sy eindbestemming te bereik!`,

  fr: `FÃ©licitations pour avoir trouvÃ© ce personnage ! Il fait partie de TagRaceâ€”une course d'aventure mondiale qui suit les dÃ©placements rÃ©els.
Il est actuellement en route vers Hope, au Canada, portÃ© par des personnes du monde entier !
Vous faites maintenant partie du voyage ! Chaque enregistrement aide Ã  tracer son parcours Ã  travers les continents. Emmenez ce personnage avec vous dans vos aventures et prenez des photos dans des lieux intÃ©ressants. AprÃ¨s l'avoir dÃ©placÃ©, laissez-le dans un endroit sÃ»r ou passez-le Ã  la personne suivante pour poursuivre son voyage mondial.

ğŸ Aidez-le Ã  atteindre sa destination finale !`,

  de: `Herzlichen GlÃ¼ckwunsch! Du hast diesen Charakter gefunden. Er ist Teil von TagRaceâ€”einem globalen Abenteuer-Rennen, das echte Bewegungen verfolgt.
Derzeit ist er auf dem Weg nach Hope, Kanada, getragen von Menschen aus aller Welt!
Du bist jetzt Teil der Reise! Jeder Check-in hilft, seinen Weg Ã¼ber Kontinente nachzuverfolgen. Nimm diesen Charakter mit auf deine Abenteuer und mache Fotos an interessanten Orten. Nachdem du ihn weitergebracht hast, lasse ihn an einem sicheren Ort oder gib ihn an die nÃ¤chste Person weiter, damit die globale Reise weitergeht.

ğŸ Hilf ihm, sein endgÃ¼ltiges Ziel zu erreichen!`,

  ja: `ã“ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’è¦‹ã¤ã‘ã¦ãã‚Œã¦ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã“ã‚Œã¯TagRaceã®ä¸€éƒ¨ã§ã™â€”ä¸–ç•Œä¸­ã‚’æ—…ã™ã‚‹ãƒªã‚¢ãƒ«ãªå†’é™ºãƒ¬ãƒ¼ã‚¹ã§ã™ã€‚
ç¾åœ¨ã€ã“ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ã‚«ãƒŠãƒ€ã®Hopeã«å‘ã‹ã£ã¦æ—…ã‚’ã—ã¦ã„ã¾ã™ã€‚ä¸–ç•Œä¸­ã®äººã€…ã«ã‚ˆã£ã¦é‹ã°ã‚Œã¦ã„ã¾ã™ï¼
ã‚ãªãŸã‚‚ã“ã®æ—…ã®ä¸€å“¡ã§ã™ï¼ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã™ã‚‹ãŸã³ã«ã€ãã®è¶³è·¡ãŒå¤§é™¸ã‚’è¶Šãˆã¦è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å†’é™ºã«é€£ã‚Œã¦è¡Œãã€é¢ç™½ã„å ´æ‰€ã§å†™çœŸã‚’æ’®ã£ã¦ãã ã•ã„ã€‚ç§»å‹•ã•ã›ãŸå¾Œã¯ã€å®‰å…¨ãªå ´æ‰€ã«ç½®ãã‹ã€æ¬¡ã®äººã«æ¸¡ã—ã¦ä¸–ç•Œã®æ—…ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚

ğŸ æœ€çµ‚ç›®çš„åœ°ã«åˆ°é”ã™ã‚‹ã®ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã„ï¼`,

  zh: `æ­å–œä½ æ‰¾åˆ°è¿™ä¸ªè§’è‰²ï¼å®ƒæ˜¯TagRaceçš„ä¸€éƒ¨åˆ†â€”â€”ä¸€ä¸ªå…¨çƒå†’é™©ç«èµ›ï¼Œè¿½è¸ªçœŸå®ä¸–ç•Œçš„ç§»åŠ¨ã€‚
å®ƒç›®å‰æ­£åœ¨å‰å¾€åŠ æ‹¿å¤§Hopeçš„æ—…ç¨‹ä¸­ï¼Œç”±ä¸–ç•Œå„åœ°çš„äººä»¬æºå¸¦ï¼
ä½ ç°åœ¨æ˜¯è¿™æ®µæ—…ç¨‹çš„ä¸€éƒ¨åˆ†ï¼æ¯ä¸€æ¬¡ç­¾åˆ°éƒ½æœ‰åŠ©äºè¿½è¸ªå®ƒç©¿è¶Šå„å¤§æ´²çš„è·¯å¾„ã€‚å¸¦ç€è¿™ä¸ªè§’è‰²å»å†’é™©ï¼Œå¹¶åœ¨æœ‰è¶£çš„åœ°ç‚¹æ‹ç…§ã€‚åœ¨ä½ ç§»åŠ¨å®ƒä¹‹åï¼Œè¯·å°†å®ƒç•™åœ¨ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ï¼Œæˆ–äº¤ç»™ä¸‹ä¸€ä¸ªäººç»§ç»­å®ƒçš„å…¨çƒæ—…ç¨‹ã€‚

ğŸ å¸®åŠ©å®ƒåˆ°è¾¾æœ€ç»ˆç›®çš„åœ°ï¼`,

  es: `Â¡Felicidades por encontrar este personaje! Es parte de TagRaceâ€”una carrera de aventuras global que rastrea el movimiento real.
Actualmente estÃ¡ en camino a Hope, CanadÃ¡, llevado por personas de todo el mundo.
Â¡Ahora eres parte del viaje! Cada registro ayuda a trazar su ruta a travÃ©s de los continentes. Lleva este personaje contigo en tus aventuras y toma fotos en lugares interesantes. DespuÃ©s de moverlo, dÃ©jalo en un lugar seguro o pÃ¡salo a la siguiente persona para continuar su viaje global.

ğŸ Â¡AyÃºdalo a llegar a su destino final!`,

  it: `Congratulazioni per aver trovato questo personaggio! Fa parte di TagRaceâ€”una gara di avventura globale che traccia movimenti reali.
Attualmente Ã¨ in viaggio verso Hope, Canada, trasportato da persone di tutto il mondo!
Ora fai parte del viaggio! Ogni check-in aiuta a tracciare il suo percorso attraverso i continenti. Porta questo personaggio con te nelle tue avventure e scatta foto in luoghi interessanti. Dopo averlo spostato, lascialo in un luogo sicuro o passalo alla prossima persona per continuare il suo viaggio globale.

ğŸ Aiutalo a raggiungere la sua destinazione finale!`,

  ru: `ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! Ğ’Ñ‹ Ğ½Ğ°ÑˆĞ»Ğ¸ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°! ĞĞ½ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ñ‡Ğ°ÑÑ‚ÑŒÑ TagRaceâ€”Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ³Ğ¾Ğ½ĞºĞ¸, Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ÑÑ‰ĞµĞ¹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ.
Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¾Ğ½ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² Ğ¥Ğ¾ÑƒĞ¿, ĞšĞ°Ğ½Ğ°Ğ´Ğ°, Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ»ÑĞ´ÑŒĞ¼Ğ¸ ÑĞ¾ Ğ²ÑĞµĞ³Ğ¾ Ğ¼Ğ¸Ñ€Ğ°!
Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹ Ñ‡Ğ°ÑÑ‚ÑŒ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ñ! ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ ĞµĞ³Ğ¾ Ğ¿ÑƒÑ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½Ñ‚Ğ¸Ğ½ĞµĞ½Ñ‚Ñ‹. Ğ’Ğ¾Ğ·ÑŒĞ¼Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ñ ÑĞ¾Ğ±Ğ¾Ğ¹ Ğ² Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞµĞ³Ğ¾ Ğ² Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ…. ĞŸĞ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞµĞ³Ğ¾ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ¹Ñ‚Ğµ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼Ñƒ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºÑƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ.

ğŸ ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ¸Ñ‚Ğµ ĞµĞ¼Ñƒ Ğ´Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğ¹ Ñ†ĞµĞ»Ğ¸!`
};

document.getElementById("language-select").addEventListener("change", function () {
  const selected = this.value;
  const intro = document.getElementById("description");
  intro.innerText = translations[selected] || translations["en"];
});
  </script>
  <p id="version-tag">ğŸ”§ Code Version: v1.8 â€” 2025-09-23</p>
</body>
</html>
