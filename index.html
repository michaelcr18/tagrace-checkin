<script>
function getLocation() {
  if (!navigator.geolocation) {
    document.getElementById("status").innerText = "âŒ Geolocation not supported.";
    return;
  }

  navigator.geolocation.getCurrentPosition(success, error);
}

function success(position) {
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;
  const location = `${lat},${lon}`;

  const payload = {
    tagId: "ZA-004",
    location: location,
    battery: "3.8V",
    status: "active",
    timestamp: new Date().toISOString()
  };

  document.getElementById("status").innerText = "ğŸ“¡ Sending check-inâ€¦";

  fetch("https://tagrace-webhook.onrender.com/checkin", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => {
    if (!res.ok) throw new Error("Server error");
    return res.json();
  })
  .then(data => {
    console.log("âœ… Response:", data);
    document.getElementById("status").innerText = "âœ… Check-in successful!";
  })
  .catch(err => {
    console.error("âŒ Error:", err);
    document.getElementById("status").innerText = "âŒ Error sending check-in.";
  });
}

function error(err) {
  document.getElementById("status").innerText = "âŒ Location error: " + err.message;
}
</script>
