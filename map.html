<!DOCTYPE html>
<html>
<head>
  <title>TagRace Journey Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibWljaGFlbGNyMTgiLCJhIjoiY21mcWxmNmpwMHNmYTJrcHllemllZG4zaSJ9.un1xljHZgdbNi0mp_OScSA';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [30.9826, -25.4996], // Initial center
      zoom: 5
    });

    // Fetch live check-ins from SheetDB
    fetch('https://sheetdb.io/api/v1/YOUR_SHEETDB_ID')
      .then(res => res.json())
      .then(data => {
        const bounds = new mapboxgl.LngLatBounds();

        data.forEach(entry => {
          if (!entry.location) return;
          const [lat, lon] = entry.location.split(',').map(Number);
          const marker = new mapboxgl.Marker()
            .setLngLat([lon, lat])
            .setPopup(new mapboxgl.Popup().setText(`üìç ${entry.tagId} @ ${entry.timestamp}`))
            .addTo(map);
          bounds.extend([lon, lat]);
        });

        if (!bounds.isEmpty()) {
          map.fitBounds(bounds, { padding: 50 });
        }
      })
      .catch(err => {
        console.error("‚ùå Error loading map data:", err);
      });
  </script>
</body>
</html>
